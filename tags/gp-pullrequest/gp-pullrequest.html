<gp-pullrequest>
	<canvas id="drawer">
	</canvas>
	<canvas id="bgcanvas">
	</canvas>
	<button class="accept" onclick={acceptpr}>
		<svg xmlns="http://www.w3.org/2000/svg" fill="#FFFFFF" height="24" viewBox="0 0 24 24" width="24">
		    <path d="M0 0h24v24H0z" fill="none"/>
		    <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
		</svg>
	</button>
	<button class="pr" onclick={rejectpr}>
		<svg xmlns="http://www.w3.org/2000/svg" fill="#FFFFFF" height="24" viewBox="0 0 24 24" width="24">
		    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
		    <path d="M0 0h24v24H0z" fill="none"/>
		</svg>
	</button>
	<script>
	var curr_img=null;
	this.on("mount",function(){
		document.querySelector('body').style.overflow="hidden";
		var el = document.getElementById('drawer');
		var bgel = document.getElementById('bgcanvas');
		el.setAttribute("width",window.innerWidth);
		el.setAttribute("height",window.innerHeight);
		bgel.setAttribute("width",window.innerWidth);
		bgel.setAttribute("height",window.innerHeight);
		curr_img=veronica.getCurrentState().data[":imgid"];

		var ctx = el.getContext('2d');
		var bgctx = bgel.getContext('2d');

		var isDrawing;
		var imgToEdit = new Image();
        var bgImg = new Image();
        imgToEdit.setAttribute("crossOrigin","Anonymous");
        bgImg.setAttribute("crossOrigin","Anonymous");

        bgImg.onload = function(){
        	var rect=bgel.getBoundingClientRect();
        	bgctx.drawImage(bgImg, 0, 0, rect.width, rect.height);
        };

        imgToEdit.onload = function () {
            //draw background image
            var rect=el.getBoundingClientRect();
            ctx.drawImage(imgToEdit, 0, 0, rect.width, rect.height);
        };

        fetch(window.ip+"/galleria/pullrequest/"+veronica.getCurrentState().data[":prid"])
        .then(res=>res.json())
        .then(data=>{
        	imgToEdit.src = window.ip+"/image/"+data.image.image_id+"/data";
        	bgImg.src = window.ip+"/image/"+data.original_image.image_id+"/data";
        });
	});

	function startEditing(el,ctx){
		
	}

	this.rejectpr=function(e){
		e.preventDefault();
		/*fetch(window.ip+"/galleria/pullrequest/send?image_id="+veronica.getCurrentState().data[":imgid"],{
			headers: { 'x-account-id': window.uid },
			method: "POST",
		})
		.then(res=>{
			alert("PR RAISED");
			veronica.loc("/");
		});*/
		alert("reject nahi kr paoge");
	}

	this.acceptpr=function(e){
		e.preventDefault();
		var el = document.getElementById('drawer');
		var bgel = document.getElementById('bgcanvas');
		
		var ctx = el.getContext('2d');
		var bgctx = bgel.getContext('2d');
		var tempImg=new Image();

		tempImg.onload=function(){
			var rect=el.getBoundingClientRect();
			bgctx.drawImage(tempImg,0,0,rect.width, rect.height);
			el.remove();
			fetch(window.ip+"/galleria/pullrequest/approve/"+veronica.getCurrentState().data[":prid"],{
				headers: { 
					'Accept': 'application/json',
					'Content-Type': 'application/json',
					'x-account-id': window.uid 
				},
				method: "POST",
				body:JSON.stringify({
					image:bgel.toDataURL()
				})
			})
			.then(res=>{
				veronica.loc("/user/"+window.uid);
			});
		}

		tempImg.src=el.toDataURL();

		// fetch(window.ip+"/galleria/pullrequest/approve?image_id="+veronica.getCurrentState().data[":imgid"],{
		// 			headers: { 'x-account-id': window.uid },
		// 			method: "POST",
		// 		})
	}

	this.on("unmount",function(){
		document.querySelector('body').style.overflow="auto";
	})
	</script>
</gp-pullrequest>