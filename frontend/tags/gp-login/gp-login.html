<gp-login>
	<div class="title titlefont">
		KanvasProject
	</div>
	<div class="fblogin" if={!userProfile} >
		<img if={!loading}
			src="https://www.takingwings.in/wp-content/plugins/wordpress-social-login/assets/img/32x32/wpzoom/facebook.png"
			width="200"
			onclick={startLoading}>
		<material-spinner if={loading}>
		</material-spinner>
	</div>
	<script>
		var self=this;
		var userStore=veronica.flux.Stores.getStore("UserStore");
		var userActions=veronica.flux.Actions.getAction("UserActions");
		
		this.userProfile=userStore.getUserProfile("me");
		this.loading=false;

		this.startLoading=function(){
			self.update({loading:true});
			window.FB&&FB.login(function(res){
				if(res.status==="connected"){
					var url = '/me?fields=name,email,picture';
	                FB.api(url, function (response) {
	                	userActions.loginUser(response,res);
	                });
				}
			});
		}

		function logInSuccess(){
			//show toast
			veronica.loc("/",true);
		}

		this.on("mount",()=>{
			if(this.userProfile){
				veronica.loc("/",true);
			}else{
				userStore.subscribe("user:login:success", logInSuccess);
			}
		});

		this.on("unmount",()=>{
			userStore.unsubscribe("user:login:success", logInSuccess);
		});
	</script>
</gp-login>